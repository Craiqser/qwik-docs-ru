---
title: Qwik City Предварительная загрузка
contributors:
  - ulic75
  - mhevery
  - adamdbradley
---

# Предварительная загрузка

Цель предварительной загрузки Qwik заключается не в том, чтобы выполнить загрузку всего приложения, а в том, чтобы предварительно загрузить и кэшировать то, что нужно в данный момент. Когда оптимизатор Qwik разбивает приложение на фрагменты, он способен понять возможные пути взаимодействия с пользователем. И исходя из этого, что не менее важно, он способен понять, какие взаимодействия невозможны.

Например, всё приложение может быть способно только нажать на кнопку, но это также означает, что всё приложение никогда не потребует ререндера. Поскольку Qwik способен понять, что возможно, а что _не_ возможно, он способен наилучшим образом собрать фрагменты для предварительной загрузки.

- [Предварительная загрузка и кэширование процессом службы](../service-worker-prefetching/index.mdx)
- [Кэширование пар запросов и ответов](../request-response-cache/index.mdx)
- [Распараллеливание сетевых запросов](../parallelizing-network-requests/index.mdx)
- [Настройка стратегий и реализаций предварительной загрузки](../../../docs/advanced/prefetching/index.mdx).

## Предварительная загрузка страницы

При загрузке страницы происходит предварительная загрузка фрагментов, которые могут быть выполнены пользователем. Предположим, что на странице есть слушатель клика по кнопке. Когда страница загружается, самое первое, что делает процесс службы, это убеждается, что бандл для этого слушателя предварительно загружен и лежит в [кэше](../request-response-cache/index.mdx). Когда пользователь кликает по кнопке, и Qwik делает запрос к бандлу слушателя событий, он уже находится в кэше, готовый к выполнению.

## Предварительная загрузка при взаимодействии

Можно считать, что загрузка страницы - это первое взаимодействие с пользователем, которое предзагружает то, с чем у пользователя может быть следующее взаимодействие. Когда произойдет следующее взаимодействие, например, открытие модального окна, то Qwik создаст ещё одно событие предварительной загрузки с дополнительными бандлами, которые могут быть использованы при следующем взаимодействии. Предварительная загрузка происходит не только при загрузке страницы, но и по мере того как пользователь взаимодействует с приложением.

## Событие предварительной загрузки

Рекомендуемая стратегия предварительной загрузки заключается в использовании [процесса службы](../service-worker-prefetching/index.mdx) для заполнения [кэша](https://developer.mozilla.org/en-US/docs/Web/API/Cache) браузера. Сам Qwik должен быть настроен на использование реализации [prefetchEvent](../../../docs/advanced/prefetching/index.mdx), которая будет отправлять событие предварительной загрузки.

Событие `qprefetch` может содержать различные подробности о том, что нужно загрузить, например:

| Данные | Описание |
| --- | --- |
| `bundles` | Массив имён JavaScript-бандлов для предварительной загрузки. Каждый бандл - коллекция `symbols`. |
| `symbols` | Массив символов (ключей) для предварительной загрузки. Процесс службы уже понимает, в какие бандлы входит каждый символ. |
| `links` | _Экспериментальный_. Массив ссылок `hrefs` для предварительной загрузки. |

### Отправка события предварительной загрузки

Ниже приведен пример диспетчеризации события предварительной загрузки. Эти события отправляются из самого Qwik и не требуют от разработчиков отправки этих событий вручную. Кроме того, [процесс службы](../service-worker-prefetching/index.mdx) автоматически добавит слушателей для этих событий.

```ts
dispatchEvent(new CustomEvent("qprefetch", { detail: {
  bundles: [...]
}}));
```
