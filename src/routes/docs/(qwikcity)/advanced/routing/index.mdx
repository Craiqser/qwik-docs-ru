---
contributors:
  - manucorporat
  - adamdbradley
  - cunzaizhuyi
  - the-r3aper7
  - mhevery
---

# Расширенная маршрутизация

## Обработка страницы 404

Любой пользователь может зайти на URL-адрес, который на вашем сайте не существует. Например, если пользователь заходит на `https://example.com/does-not-exist`, то сервер должен ответить [кодом состояния HTTP 404](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404), а на странице должно быть хоть какое-то объяснение произошедшего, а не просто пустая страница.

Для каждого заданного маршрута Qwik City может выбрать, как лучше всего для пользователя обработать ответ 404, будь то страница 404 по умолчанию, пользовательская страница 404 или динамически создаваемая страница 404.

### Страница 404 по умолчанию

Вместо того чтобы показывать пустую страницу, Qwik City по умолчанию предоставляет типовую страницу 404 для любого маршрута, который не обрабатывается. Страница 404 по умолчанию рендерится в качестве запасного варианта, когда не найдена пользовательская страница 404. Страница Qwik City по умолчанию - это хорошо и всё такое, но мы рекомендуем создать пользовательскую страницу 404, чтобы пользователю было удобнее. Например, предоставить ему общий заголовок и навигацию, чтобы он мог найти страницу, которую он ищет.

### Пользовательская страница 404

Вместо того чтобы показывать стандартный (скучный) ответ 404, можно создать собственную страницу 404, используя те же привычные макеты, что и на остальных страницах вашего сайта.

Чтобы создать пользовательскую страницу 404, добавьте файл `404.tsx` в корневой каталог `src/routes`.

```bash
src/
└── routes/
    ├── 404.tsx            # Пользовательская страница 404
    ├── layout.tsx         # Макет по умолчанию
    └── index.tsx          # https://example.com/
```

В приведенном примере страница `404.tsx` также будет использовать макет `layout.tsx`, поскольку она является соседом этого макета в том же каталоге.

Кроме того, использование маршрутизации на основе каталога Qwik City позволяет создавать пользовательские страницы 404 по разным путям. Например, если в структуру проекта был добавлен файл `src/routes/account/404.tsx`, то пользовательская страница 404 будет применяться только для маршрутов `/account/*`, а все остальные страницы 404 будут использовать корневую страницу `404.tsx`.

> Примечание: Во время разработки и в режиме предварительного просмотра пользовательские страницы 404 не будут отображаться, вместо них будет отображаться стандартная страница 404 Qwik City. Однако при сборке приложения для производственной среды пользовательская страница 404 будет сгенерирована в виде статического файла `404.html`.

```bash
src/
└── routes/
    ├── account/
    │   └── 404.tsx        # Пользовательская страница 404 для маршрута `account/*``
    │   └── index.tsx      # https://example.com/account/
    ├── 404.tsx            # Пользовательская страница 404
    ├── layout.tsx         # Макет по умолчанию
    └── index.tsx          # https://example.com/
```

Также обратите внимание, что пользовательские страницы 404 статически генерируются во время сборки приложения, что означает, что в итоге они становятся статическими файлами `404.html`, а не страницами, которые рендерятся на стороне сервера. Создание статических страниц `404.html` помогает гарантировать, что ваш HTTP-сервер не будет заниматься их рендером и потреблять ресурсы.

### Динамическая страница 404

После рендера страницы по умолчанию всегда возвращается ответ с [кодом состояния HTTP 200](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/200), который сообщает браузеру что всё хорошо, и маршрут, по которому вы перешли, существует. Однако, можно перехватить рендер страницы, и вручную установить код статуса ответа, отличный от 200, например 404.

Допустим, у нас есть страница товара с URL-адресом `https://example.com/product/abc`. Страница товара обрабатывается с помощью маршрута на основе каталога `src/routes/product/[id]/index.tsx`, а `[id]` является динамическим параметром URL-адреса.

В этом примере `id` используется в качестве ключа для загрузки данных о товаре из базы данных. Если данные о товаре найдены, отлично, мы можем отобразить данные. Однако, если данные о товаре не найдены в базе данных, мы всё равно можем обработать рендер этой страницы, но ответить кодом состояния HTTP 404.

```tsx
import { component$ } from '@builder.io/qwik';
import { routeLoader$ } from '@builder.io/qwik-city';

export const useProductLoader = routeLoader$(async ({ params, status }) => {
  // Пример вызова базы данных с использованием параметра id.
  // База данных может вернуть `null`, если товар не найден.
  const data = await productDatabase.get(params.id);

  if (!data) {
    // Данные о товаре не найдены.
    // Меняем код статуса ответа на 404.
    status(404);
  }

  // Возвращаем данные (которые могут быть `null`).
  return data;
});

export default component$(() => {
  // Получаем данные о товаре из загрузчика.
  const product = useProductLoader();

  if (!product.value) {
    // Данные о товаре не найдены.
    // Поэтому рендерим нашу пользовательскую страницу 404 для товара.
    return <p>Извините, у нас нет этого товара.</p>;
  }

  // Данные о товаре были найдены, так что давайте отобразим их.
  return (
    <div>
      <h1>{product.value.name}</h1>
      <p>{product.value.price}</p>
      <p>{product.value.description}</p>
    </div>
  );
});
```

## Сгруппированные макеты

Маршруты общего назначения часто помещают в каталоги, чтобы они могли совместно использовать макеты, и чтобы связанные исходные файлы были логически сгруппированы друг с другом. Однако может возникнуть желание, чтобы каталог, который использовался для группировки похожих файлов и совместного использования макетов, был исключен из общедоступных URL-адресов. Здесь поможет "группировка" макетов (так называемый макет маршрута "без пути").

Если заключить имя каталога в круглые скобки - `(имя)`, то этот каталог не будет включён в URL-адрес.

Например, предположим, что все маршруты, содержащие _account_, расположены в одном каталоге `/account/`. Однако, он может быть удалён из URL-адреса для получения более чистых и кратких URL-адресов. В приведённом ниже примере обратите внимание на то, что пути находятся в каталоге `src/routes/(account)/`, однако URL-адреса исключают `(account)/`.

```bash
src/
└── routes/
    └── (account)/         # Обратите внимание на круглые скобки
        ├── layout.tsx     # Макет для account
        └── profile/
            └── index.tsx  # https://example.com/profile
        └── settings/
            └── index.tsx  # https://example.com/settings
```

## Именованный макет

Иногда маршруты нуждаются в макетах, коренным образом отличающихся от макетов соседних маршрутов. В этом случае можно определить несколько макетов для одноуровневых маршрутов. Один макет по умолчанию и любое количество именованных макетов. Затем дочерний маршрут может запросить определённый именованный макет.

Qwik City определяет соглашение о том, что макеты находятся внутри каталога `src/routes`, а имена файлов начинаются с `layout`. Именно поэтому макет по умолчанию называется `layout.tsx`. Именованный макет также начинается с `layout`, за которым следует тире `-` и уникальное имя, например `layout-narrow.tsx`.

```bash
src/
└── routes/
    ├── contact/
    │   └── index@narrow.tsx      # https://example.com/contact (Макет: layout-narrow.tsx)
    ├── layout.tsx                # Макет по умолчанию
    ├── layout-narrow.tsx         # Именованный макет
    └── index.tsx                 # https://example.com/ (Макет: layout.tsx)
```

- `https://example.com/`
  ```
  ┌──────────────────────────────────────────────────┐
  │       src/routes/layout.tsx                      │
  │  ┌────────────────────────────────────────────┐  │
  │  │    src/routes/index.tsx                    │  │
  │  │                                            │  │
  │  └────────────────────────────────────────────┘  │
  │                                                  │
  └──────────────────────────────────────────────────┘
  ```
- `https://example.com/contact`
  ```
  ┌──────────────────────────────────────────────────┐
  │       src/routes/layout-narrow.tsx               │
  │  ┌────────────────────────────────────────────┐  │
  │  │    src/routes/contact/index@narrow.tsx     │  │
  │  │                                            │  │
  │  └────────────────────────────────────────────┘  │
  │                                                  │
  └──────────────────────────────────────────────────┘
  ```

## Вложенный макет

Иногда хочется вложить макеты друг в друга. Содержимое страницы может быть вложено в несколько оборачивающих её макетов, это определяется структурой каталогов.

```bash
src/
└── routes/
    ├── layout.tsx           # Родительский макет
    └── about/
        ├── layout.tsx       # Дочерний макет
        └── index.tsx        # https://example.com/about
```

В приведённом выше примере есть два макета, которые оборачивают страницу `/about`.

1. `src/routes/layout.tsx`
2. `src/routes/about/layout.tsx`

В этом случае макеты будут вкладываться друг в друга, оборачивая страницу.

```
┌────────────────────────────────────────────────┐
│       src/routes/layout.tsx                    │
│  ┌──────────────────────────────────────────┐  │
│  │    src/routes/about/layout.tsx           │  │
│  │  ┌────────────────────────────────────┐  │  │
│  │  │ src/routes/about/index.tsx         │  │  │
│  │  │                                    │  │  │
│  │  └────────────────────────────────────┘  │  │
│  │                                          │  │
│  └──────────────────────────────────────────┘  │
│                                                │
└────────────────────────────────────────────────┘
```

```tsx title="src/routes/layout.tsx"
import { component$ } from '@builder.io/qwik';

export default component$(() => {
  return (
    <main>
      <Slot /> {/* <== Здесь будет вставлен дочерний макет/маршрут */}
    </main>
  );
});
```

```tsx title="src/routes/about/layout.tsx"
import { component$ } from '@builder.io/qwik';

export default component$(() => {
  return (
    <section>
      <Slot /> {/* <== Здесь будет вставлен дочерний макет/маршрут */}
    </section>
  );
});
```

```tsx title="src/routes/about/index.tsx"
import { component$ } from '@builder.io/qwik';

export default component$(() => {
  return <h1>О сайте</h1>;
});
```

Для приведённого выше примера будет отображаться следующий HTML:

```html
<main>
  <section>
    <h1>О сайте</h1>
  </section>
</main>
```
